# –ü—Ä–æ–µ–∫—Ç Datalouna

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **Node.js**-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ **TypeScript** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Express**, **Postgres** –∏ **Redis**. –í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:

- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (JWT)
- **–ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤** (–æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–∞–Ω—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- **–ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** (–ø—Ä–∏–º–µ—Ä —Å API Skinport –∏ Redis)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** Swagger

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
.
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îú‚îÄ‚îÄ controllers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ items.controller.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ purchases.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ dtos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.dto.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ purchase.dto.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ middleware
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.middleware.ts
‚îÇ   ‚îú‚îÄ‚îÄ services
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ items.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ purchases.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ types
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.types.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ item.interface.ts
‚îÇ   ‚îú‚îÄ‚îÄ db.ts           # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Postgres
‚îÇ   ‚îú‚îÄ‚îÄ redis.ts        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
‚îÇ   ‚îú‚îÄ‚îÄ config.ts       # Config (env) —Ñ–∞–π–ª
‚îÇ   ‚îú‚îÄ‚îÄ swagger.ts      # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Swagger
‚îÇ   ‚îú‚îÄ‚îÄ app.ts          # –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Express-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ index.ts        # –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (–ø—Ä–∏–º–µ—Ä)
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ .env
‚îî‚îÄ‚îÄ README.md
```

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

- **Express**: —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–≤
- **TypeScript**: —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞
- **Postgres**: –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis**: –∫—ç—à –∏ –±—ã—Å—Ç—Ä–∞—è in-memory –±–∞–∑–∞
- **express-jwt / jsonwebtoken**: –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ JWT
- **class-validator / class-transformer**: –≤–∞–ª–∏–¥–∞—Ü–∏—è DTO
- **Swagger**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä API-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Node.js** (–≤–µ—Ä—Å–∏—è 14+)
2. **npm** –∏–ª–∏ **yarn**
3. **Docker** –∏ **Docker Compose** (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ Postgres –∏ Redis)

## –®–∞–≥–∏ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/–≤–∞—à-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π/datalouna.git
cd datalouna
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
npm install
# –∏–ª–∏
yarn
```

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ñ–∞–π–ª **.env**, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–ø–∏—Å–∞–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ü—Ä–∏–º–µ—Ä (–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):

```bash
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_DB=datalouna_db
DATABASE_USER=postgres
DATABASE_PASSWORD=postgres
DATABASE_PORT_OUT=5445

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PORT_OUT=3322

PORT=3000
```

> **Note**: –í–∞–∂–Ω–æ, —á—Ç–æ–±—ã `DATABASE_PORT_OUT` –∏ `REDIS_PORT_OUT` —Å–æ–≤–ø–∞–¥–∞–ª–∏ —Å –ø–æ—Ä—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç–µ –≤ **docker-compose.yml** (—Å–º. –Ω–∏–∂–µ).

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker Compose

–í **docker-compose.yml** –æ–ø–∏—Å–∞–Ω—ã —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Postgres –∏ Redis:

```bash
docker-compose up -d
```

- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä Postgres –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ **localhost:5445** (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ‚Äì –ø–æ—Ä—Ç 5432).
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä Redis –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ **localhost:3322** (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ‚Äì –ø–æ—Ä—Ç 6379).

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–±–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω—ã:

```bash
docker ps
```
–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã **postgres** –∏ **redis**.

### 5. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

–í –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å SQL-—Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –∏ –≤—Å—Ç–∞–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –í—ã –º–æ–∂–µ—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏—Ö –≤—Ä—É—á–Ω—É—é –∏–ª–∏ —á–µ—Ä–µ–∑ —Å–≤–æ–π —Å–ø–æ—Å–æ–± –º–∏–≥—Ä–∞—Ü–∏–π. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ psql:

```bash
psql -h localhost -p 5445 -U postgres -d datalouna_db -f ./path/to/your/script.sql
```

(–õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π GUI, –Ω–∞–ø—Ä–∏–º–µ—Ä pgAdmin.)

### 6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
npm run build    # –ö–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript -> JS
npm run start    # –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ (dist/)
```

> –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (—Å `ts-node-dev`):
> ```bash
> npm run dev
> ```

–í—ã —É–≤–∏–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏:

```
üëÄ Connecting to database with the following parameters:
  Host: localhost
  Port: 5445
  Database: datalouna_db
  User: postgres

üöÄ Server started on http://localhost:3000

‚ô®Ô∏è Connected to Redis

üóÉÔ∏è Database connected successfully
```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É [http://localhost:3000](http://localhost:3000).

### 7. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ó–∞–π–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞:
```
http://localhost:3000/docs
```
–¢–∞–º –≤—ã –Ω–∞–π–¥—ë—Ç–µ –≤—Å–µ –æ–ø–∏—Å–∞–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (Auth, Items, Purchases –∏ —Ç.–¥.).

---

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

### Auth (JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)

- **POST /auth/register**
  –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON):
  ```json
  {
    "email": "user@example.com",
    "password": "securepassword"
  }
  ```
- **POST /auth/login**
  –õ–æ–≥–∏–Ω–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `auth_token` (JWT):
  ```json
  {
    "auth_token": "eyJhbGci..."
  }
  ```
- **POST /auth/change-password** *(—Ç—Ä–µ–±—É–µ—Ç—Å—è JWT)*
  –ú–µ–Ω—è–µ—Ç –ø–∞—Ä–æ–ª—å —É —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –í –∑–∞–≥–æ–ª–æ–≤–∫–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `Authorization: Bearer <token>`.

### Items (–ø—Ä–∏–º–µ—Ä —Å Skinport API)

- **GET /items/getAll**
  –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–µ–¥–º–µ—Ç–∞—Ö –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ API Skinport (–∫–∞–∫ –¥–ª—è `tradable`, —Ç–∞–∫ –∏ –¥–ª—è `non-tradable`), –º—ë—Ä–¥–∂–∏—Ç –∏—Ö –∏ –∫—ç—à–∏—Ä—É–µ—Ç –≤ Redis.
  - –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ Skinport, –∑–∞—Ç–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ Redis.
  - –ü—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö, –ø–æ–∫–∞ –∫—ç—à –Ω–µ –∏—Å—Ç—ë–∫, –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ Redis.

### Purchases (–ø–æ–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤)

- **GET /purchases/products**
  –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–∏–∑ —Ç–∞–±–ª–∏—Ü—ã `products` –≤ Postgres).

- **POST /purchases/buy** *(—Ç—Ä–µ–±—É–µ—Ç—Å—è JWT)*
  –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫—É–ø–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç. –í—ã—á–∏—Ç–∞–µ—Ç—Å—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏–∑ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `purchases`.

```json
{
  "productId": 1
}
```

–ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω –∏–ª–∏ –ø—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤–µ—Ä–Ω—ë—Ç—Å—è –æ—à–∏–±–∫–∞ 400.

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

1. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ [postgres](https://www.npmjs.com/package/postgres) –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Postgres.
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `src/db.ts`, –∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ `process.env`.

2. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç [redis](https://www.npmjs.com/package/redis).
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `src/redis.ts`, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ç–æ–∂–µ –∏–¥—É—Ç –∏–∑ `.env`.

3. **JWT-—Å–µ–∫—Ä–µ—Ç**
   - –í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ `secretSuper` –ø—Ä–æ–ø–∏—Å–∞–Ω –∂—ë—Å—Ç–∫–æ –≤ –∫–æ–¥–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–Ω–µ—Å—Ç–∏ —Å–µ–∫—Ä–µ—Ç –≤ `.env`.

4. **–°–∫—Ä–∏–ø—Ç—ã npm**
   - `npm run build` ‚Äî –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç TypeScript –≤ `dist/`.
   - `npm run start` ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç Node.js —Å —É–∂–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏.
   - `npm run dev` ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ dev-—Ä–µ–∂–∏–º–µ (hot-reload —á–µ—Ä–µ–∑ ts-node-dev).

5. **Swagger**
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Swagger –æ–ø–∏—Å–∞–Ω—ã –≤ `src/swagger.ts`.
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ `/docs`.
